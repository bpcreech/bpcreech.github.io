<!doctype html><html class=no-js lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>How this site works - Disparate Treasures</title>
<script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script>
<meta name=description content>
<meta property="og:title" content="How this site works">
<meta property="og:description" content="TL;DR: github.com/bpcreech/blog ⇨ Hugo (via Github actions) ⇨ github.com/bpcreech.github.io ⇨ Github pages. With DNS mapped via Google Domains (soon, RIP).">
<meta property="og:type" content="article">
<meta property="og:url" content="/post/how-this-works/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2024-02-03T00:00:00+00:00">
<meta property="article:modified_time" content="2024-02-03T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="How this site works">
<meta name=twitter:description content="TL;DR: github.com/bpcreech/blog ⇨ Hugo (via Github actions) ⇨ github.com/bpcreech.github.io ⇨ Github pages. With DNS mapped via Google Domains (soon, RIP).">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=dns-prefetch href=//fonts.googleapis.com>
<link rel=dns-prefetch href=//fonts.gstatic.com>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/custom.css>
<link rel="shortcut icon" href=/favicon.ico>
</head>
<body class=body>
<div class="container container--outer">
<header class=header>
<div class="container header__container">
<div class=logo>
<a class=logo__link href=/ title="Disparate Treasures" rel=home>
<div class="logo__item logo__text">
<div class=logo__title>Disparate Treasures</div>
<div class=logo__tagline>Ben Creech's arbitrary stuff</div>
</div>
</a>
</div>
<div class=divider></div>
</div>
</header>
<div class="wrapper flex">
<div class=primary>
<main class=main role=main>
<article class=post>
<header class=post__header>
<h1 class=post__title>How this site works</h1>
<p class=post__lead>How this site works</p>
</header>
<div class="post__toc toc">
<div class=toc__title>Page content</div>
<div class=toc__menu>
<nav id=TableOfContents>
<ul>
<li><a href=#tell-me-more-for-some-reason>Tell me more for some reason</a></li>
<li><a href=#alternative-considered-google-cloud-platform>Alternative considered: Google Cloud Platform</a>
<ul>
<li><a href=#more-complicated-more-maintenance>More complicated, more maintenance</a></li>
<li><a href=#unbounded-costs>Unbounded costs</a></li>
<li><a href=#the-simple--cheap-flavor-of-serving-a-static-site-from-cloud-storage-is-deprecated-because-no-https>The simple & cheap flavor of serving a static site from Cloud Storage is ~deprecated because no HTTPS</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div><div class="content post__content clearfix">
<p><strong>TL;DR</strong>: <a href=https://github.com/bpcreech/blog>github.com/bpcreech/blog</a> ⇨ <a href=https://gohugo.io/>Hugo</a> (via Github actions) ⇨ <a href=https://github.com/bpcreech.github.io>github.com/bpcreech.github.io</a> ⇨ Github pages. With DNS mapped via Google Domains (soon, RIP).</p>
<h2 id=tell-me-more-for-some-reason>Tell me more for some reason</h2>
<p><a href=https://ruddra.com/hugo-deploy-static-page-using-github-actions/>This super awesome page</a> by Arnab Kumar Shil shows how to:</p>
<ol>
<li>
<p>Start from <a href=https://github.com/bpcreech/blog>blog content in source form</a> (mostly <a href=https://www.markdownguide.org/>Markdown</a>) in one Github repo.</p>
</li>
<li>
<p><a href=https://github.com/bpcreech/blog/blob/main/.github/workflows/publish.yaml>Configure</a> <a href=https://github.com/features/actions>Github Actions</a> to automatically run the static site generator <a href=https://gohugo.io/>Hugo</a> upon any commit and schlep that generatic content into <a href=https://github.com/bpcreech/bpcreech.github.io><em>another</em> Github repo</a>.</p>
</li>
<li>
<p>From <em>there</em> the built-in <a href=https://pages.github.com/>Github Pages</a> Github Actions automatically update bpcreech.github.io with that content.</p>
</li>
<li>
<p>We can also, thanks to Github Pages' <a href=https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages>custom domains feature</a>, redirect traffic from bpcreech.com to bpcreech.github.io at the DNS layer.</p>
<ul>
<li>One cool part about this which I wasn&rsquo;t expecting: Github pages automatically obtains a <a href=https://letsencrypt.org/>Let&rsquo;s Encrpyt</a> certificate for domains you configure this way. So I didn&rsquo;t even have to generate a certificate!</li>
</ul>
</li>
<li>
<p>Speaking of DNS, in my case the DNS layer is managed by Google Domains&mldr; <a href=https://blog.pragmaticengineer.com/google-domains-to-shut-down>which is over time becoming SquareSpace domains</a>.</p>
</li>
</ol>
<p>Yay, highly-scalable web hosting for just the cost of $12/year from Google Domains for a custom domain! (Within, you know, <a href=https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages>limits</a> <em>including that you don&rsquo;t mind your source being public</em>.)</p>
<p>| <img src=/img/i-can-has-https.png alt="A browser pointing at bpcreech.com, showing https enabled"> | <img src=/img/lets-encrypt.png alt="Cert details listing Let&rsquo;s Encrypt as the authority"> |
|Hooray, <code>https</code> works!|Thanks, Let&rsquo;s Encrypt!|</p>
<h2 id=alternative-considered-google-cloud-platform>Alternative considered: Google Cloud Platform</h2>
<p><em>This is way too much info, just writing for my future reference I guess&mldr;</em></p>
<p>An earlier version of this site, from way back in 2018, worked this way:</p>
<ol>
<li>A Github web hook, which called,</li>
<li>A Google Kubernetes Engine (GKE) cluster,</li>
<li>Which ran <a href=https://github.com/bpcreech/hugohook>a tiny Go program</a> which downloaded the repo and ran Hugo on it, and then&mldr;</li>
<li>Schlepped the generated files into Google Cloud Storage (GCS)</li>
</ol>
<p>This worked! But several ways in which it wasn&rsquo;t as good:</p>
<h3 id=more-complicated-more-maintenance>More complicated, more maintenance</h3>
<p>Running your own GKE cluster can involve some maintenance and actual $ costs. Github Actions was <a href=https://techcrunch.com/2018/10/16/github-launches-actions-its-workflow-automation-tool>launched in October 2018</a> just a month after I originally set this up. It&rsquo;s far easier to set up and maintain within the confines of what I want (including, e.g., that I don&rsquo;t have much in the way of expectations around availability which <a href=https://www.githubstatus.com/history>has been problematic</a> on Github Actions, and the &ldquo;build&rdquo; operations I&rsquo;m running are cheap enough to be free).</p>
<p>If I were to redo this <em>without</em> Github Actions I&rsquo;d use <a href=https://cloud.google.com/run>Google Cloud Run</a> (i.e., containerized serverless) along with <a href="https://github.com/google-github-actions/auth?tab=readme-ov-file#direct-wif">this fancy new Workload Identity Pool authn scheme</a> in lieu of shared secrets. (I played with this too recently. It works! It&rsquo;s super cool! It&rsquo;s not worth it for this.)</p>
<h3 id=unbounded-costs>Unbounded costs</h3>
<p>A GKE cluster and GCS bucket, like many things on Google Cloud, can generate unbounded cost if something goes really haywire. <a href=https://stackoverflow.com/questions/27616776/how-do-i-set-a-cost-limit-in-google-developers-console>Google Cloud does not offer any built-in way to set a max billing limit</a>. <a href="https://news.ycombinator.com/item?id=25398148">This can bankrupt you overnight</a> unless you can successfully beg Google to forgive your bill. Probably okay if running a company which has an ops team to pay attention to such things. Definitely not worth the risk for a personal blog which I sometime forget exists!</p>
<p>Now, you can set up a <a href=https://cloud.google.com/billing/docs/how-to/notify>Cloud Function which checks and disables billing</a>. I played with this. It&rsquo;s not terribly hard to get working, but you need to test it carefully, because the consequencies if it fails are, again, <a href="https://news.ycombinator.com/item?id=25398148">dire</a>). That makes me nervous, so no thanks, for now.</p>
<h3 id=the-simple--cheap-flavor-of-serving-a-static-site-from-cloud-storage-is-deprecated-because-no-https>The simple & cheap flavor of serving a static site from Cloud Storage is ~deprecated because no HTTPS</h3>
<p>Google <a href=https://web.archive.org/web/20180112010509/https://cloud.google.com/storage/docs/hosting-static-website>used to host instructions</a> for serving a static site from Google Cloud Storage (GCS) by simply pointing your domain&rsquo;s <code>A</code> and <code>AAAA</code> records to a GCS VIP. The servers behind the GCS VIP, which presumably got requests for a gazillion different buckets, would then use some form of <a href=https://en.wikipedia.org/wiki/Virtual_hosting>vhosting</a> to identify which bucket to serve up.</p>
<p>This is, presumably, similar to how Github pages work today.</p>
<p>The problem was that <a href=https://web.archive.org/web/20170327185149/https://cloud.google.com/storage/docs/static-website#https>this only worked for plaintext <code>http</code> (not <code>https</code>)</a>. It looks like Google never did the magic trick that Github Pages do today of dynamically provisioning a cert (using Let&rsquo;s Encrypt). You could argue that this silly blog doesn&rsquo;t need <code>https</code> but it&rsquo;s <a href=https://blog.chromium.org/2023/08/towards-https-by-default.html>not on the right side of history</a>, and so it&rsquo;s not surprising that Google has removed these old vhosting-oriented instructions.</p>
<p>They <em>could</em> have gone with a Github-Pages-like Let&rsquo;s Encrypt path, by setting up a place to declare a desire for Google to go provision a cert for you, but instead, the <a href=https://cloud.google.com/storage/docs/hosting-static-website>new host-your-site-from-GCS instructions</a> go with a more complex path of:</p>
<ol>
<li>Allocating a static VIP (presumably both IPv4 and IPv6),</li>
<li>Obtaining and generating your own cert, and</li>
<li>Setting up the Google Cloud Load Balancer pointing that VIP to your bucket using your cert.</li>
</ol>
<p>This is more flexible and powerful (way more knobs to play with on both the cert and the load balancer!), but it&rsquo;s more complicated. The fact that it uses a static VIP means you need to pay for an ever-diminishing and thus <a href=https://cloud.google.com/vpc/network-pricing#ipaddress>ever-more-costly resource</a>. (As of this writing, unused IPv4 addresses cost $113, and AFAICT ones mapped to GCS buckets are free?! I assume that will change eventually as <a href=https://ipv4.potaroo.net/>availability dwindles</a>.)</p>
<p>I suppose that once IPv4 is sufficiently exhausted, after the ensuing chaos, everyone&rsquo;s crappy ISP will finally support IPv6 it will be more reasonable to just generate free static IPv6 VIPs (forgoing IPv4), and then dispense with server-side tricks like vhosting to map multiple sites onto one address. In the meanwhile, &ldquo;I just want to serve 4 TB from GCS&rdquo; is a slightly more complicated and potentially not-quite-free.</p>
</div>
<footer class=post__footer>
<div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg>
<ul class=tags__list>
<li class=tags__item>
<a class="tags__link btn" href=/tags/how-this-works/ rel=tag>how-this-works</a>
</li>
</ul>
</div>
</footer>
</article>
</main>
<div class="authorbox clearfix">
<figure class=authorbox__avatar>
<img alt="Ben Creech avatar" src=/img/maine_cropped.png class=avatar height=90 width=90>
</figure>
<div class=authorbox__header>
<span class=authorbox__name>About Ben Creech</span>
</div>
<div class=authorbox__description>
Ben Creech is definitely a real person and insisting on this fact is not at all weird.
</div>
</div>
</div>
</div>
<footer class=footer>
<div class="container footer__container flex">
<div class=footer__copyright>
&copy; 2024 Ben Creech.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span>
</div>
</div>
</footer>
</div>
<script async defer src=/js/menu.js></script>
<script src=/js/custom.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>